<?phpclass ClockTag extends ClockTagRoot{ 	/* *************** Pattern constructor *************** */	function ClockTag(){		parent::ClockTagRoot();	}	/* *************** Install functions *************** */	function install(){		parent::install();	}	/**	 * Store an array of tags and manager the clock-tag relation	 * @param $tags Array of tag names	 */	function storeTags($clockId,$tags){		if(toInt($clockId) > 0){			for ($i = 0; $i < sizeof($tags); $i++) {				$n = $tags[$i];				$obj = new Tag();				$obj->setTag($n);				$obj->storeObj();			}			$strSQL = "" .				"INSERT IGNORE INTO clockTag " .				"(incDate,clockId,tagId) " .				"(SELECT ".time().",".$clockId.",id " .				"FROM tag " .				"WHERE tag IN ("."'".implode("','",$tags)."'"."))";			 $this->id = $this->DB->exe("".$this->className." :: storeTags($tags) - INSERT IGNORE",$strSQL);			 			 	$strSQL = "" .				"DELETE FROM clockTag " .				"WHERE 1 " .				"AND clockId = $clockId " .				"AND tagId NOT IN (SELECT id from tag WHERE tag IN ("."'".implode("','",$tags)."'".")) " .				"";			 $this->id = $this->DB->exe("".$this->className." :: storeTags($tags) - DELETE excluded tags",$strSQL);			 				}				}			function loadByTagId($tagid){		if(toInt($tagid) <= 0) return array();		$strSQL = "" . 			"SELECT * " . 			"FROM ".$this->dbTable." " . 			"WHERE 1=1 " . 			"AND tagId = $tagid " . 			"ORDER BY clockId " . 			""; 		$result = $this->DB->getObj("".$this->className." :: function loadByTagId($tagid)",$strSQL); 		$all = Array(); 		$i	 = 0; 		while ($row=mysql_fetch_array($result)){ 			$all[$i] = new ClockTag(); 			$all[$i]->setFromRow($row); 			$i++; 		}		return $all; 	}	function loadByClockId($clockId){		if(toInt($clockId) <= 0) return array();		$strSQL = "" . 			"SELECT * " . 			"FROM ".$this->dbTable." " . 			"WHERE 1=1 " . 			"AND clockId = $clockId " . 			"ORDER BY tagId " . 			""; 		$result = $this->DB->getObj("".$this->className." :: function loadByClockId($clockId)",$strSQL); 		$all = Array(); 		$i	 = 0; 		while ($row=mysql_fetch_array($result)){ 			$all[$i] = new ClockTag(); 			$all[$i]->setFromRow($row); 			$i++; 		}		return $all;		echo  $all;	}	/**	 * Return the Tag objects related to a given clockId 	 */	function loadTagsByClockId($clockId){		if(toInt($clockId) <= 0) return array();		$strSQL = "" . 			"SELECT tag.* " . 			"FROM ".$this->dbTable.", tag " . 			"WHERE 1=1 " . 			"AND tagId = tag.id " . 			"AND clockId = $clockId " . 			"ORDER BY tagId " . 			""; 		$result = $this->DB->getObj("".$this->className." :: function loadTagsByClockId($clockId)",$strSQL); 		$all = Array(); 		$i	 = 0; 		while ($row=mysql_fetch_array($result)){ 			$all[$i] = new Tag(); 			$all[$i]->setFromRow($row); 			$i++; 		}			return $all; 	}}?>